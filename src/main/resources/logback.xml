<?xml version="1.0" encoding="UTF-8"?>
<configuration debug="true">
    <include resource="org/springframework/boot/logging/logback/base.xml"/>

    <property resource="application.properties"/>

    <appender name="smtp" class="ch.qos.logback.classic.net.SMTPAppender">
        <smtpHost>${spring.mail.host}</smtpHost>
        <smtpPort>${spring.mail.port}</smtpPort>
        <username>${spring.mail.username}</username>
        <password>${spring.mail.password}</password>
        <from>${checkin.mail.from}</from>
        <to>${checkin.mail.admin}</to>
        <layout class="ch.qos.logback.classic.html.HTMLLayout" />
        <cyclicBufferTracker class="ch.qos.logback.core.spi.CyclicBufferTracker">
            <bufferSize>1</bufferSize>
        </cyclicBufferTracker>
        <evaluator class="ch.qos.logback.classic.boolex.OnMarkerEvaluator">
            <marker>SEND_MAIL</marker>
        </evaluator>
    </appender>

    <appender name="slack" class="at.refugeescode.checkin.config.SlackAppender">
        <webhookURL>${checkin.slack.webhookURL}</webhookURL>
        <channel>${checkin.slack.channel}</channel>
        <layout class="ch.qos.logback.classic.PatternLayout">
            <pattern>%msg%n</pattern>
        </layout>
        <username>${HOSTNAME}</username>
        <icon>${checkin.slack.icon}</icon>
        <evaluator class="ch.qos.logback.classic.boolex.OnMarkerEvaluator">
            <marker>POST_TO_SLACK</marker>
        </evaluator>
    </appender>

    <root>
        <appender-ref ref="smtp" />
        <appender-ref ref="slack" />
    </root>

</configuration>